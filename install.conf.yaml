- defaults:
    link:
      create: true
      relink: true
      force: false

- clean: ["~"]

- link:
    # dotfiles
    ~/.zshenv: .zshenv
    ~/.bashrc: .bashrc
    ~/.editorconfig: .editorconfig
    ~/.zshrc: dotconfig/zsh/.zshrc
    ~/.vimrc: dotconfig/vim/vimrc
    # dotlocal
    ~/.local/bin/sync-projects: bin/sync-projects
    # dotconfig
    ~/.config/uv: dotconfig/uv
    ~/.config/zsh: dotconfig/zsh
    ~/.config/mise: dotconfig/mise
    ~/.config/tmux: dotconfig/tmux
    ~/.config/git: dotconfig/git
    ~/.config/vim: dotconfig/vim
    ~/.config/starship.toml: dotconfig/starship.toml
    ~/.config/systemd:
      path: dotconfig/systemd
      force: true
    ~/.config/environment.d: dotconfig/environment.d
    ~/.config/rclone/excludes.txt: dotconfig/rclone/excludes.txt

- create:
    - ~/projects
    - ~/.config/sync-projects

- shell:
    - [
        "cp -n dotconfig/sync-projects/env ~/.config/sync-projects/env || true",
        Installing sync-projects env,
      ]
    - [
        git submodule update --init --recursive --progress,
        Installing submodules,
      ]

    - [
        command -v starship || { curl -fsSL https://starship.rs/install.sh -o /tmp/starship_install.sh && sh /tmp/starship_install.sh -y -f && rm /tmp/starship_install.sh; },
        Installing Starship,
      ]
    - [command -v mise || { curl -fsSL https://mise.run -o /tmp/mise_install.sh && sh /tmp/mise_install.sh && rm /tmp/mise_install.sh; }, Installing mise]
    -
      command: 'mise doctor || true'
      description: Validating mise setup
      if: 'command -v mise'
    -
      command: 'command -v mise && mise install || true'
      description: Installing pinned mise tools
      if: 'command -v mise'

    # Tmux plugin manager (TPM) and plugins
    -
      command: '[ -d ~/.tmux/plugins/tpm ] || git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'
      description: Installing tmux plugin manager (TPM)
      if: 'command -v tmux'

    -
      command: '[ -x ~/.tmux/plugins/tpm/scripts/install_plugins.sh ] && ~/.tmux/plugins/tpm/scripts/install_plugins.sh || true'
      description: Installing tmux plugins
      if: 'command -v tmux'
