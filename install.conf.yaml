- defaults:
    link:
      create: true
      relink: true
      force: false

- clean: ["~"]

- link:
    # Shell
    ~/.zshenv: .zshenv
    ~/.bashrc: .bashrc

    # XDG Config
    ~/.config/zsh: dotconfig/zsh
    ~/.config/mise: dotconfig/mise
    ~/.config/tmux: dotconfig/tmux
    ~/.config/git: dotconfig/git
    ~/.config/vim: dotconfig/vim
    ~/.vimrc: dotconfig/vim/vimrc
    ~/.config/starship.toml: dotconfig/starship.toml
    ~/.config/systemd:
      path: dotconfig/systemd
      force: true
    ~/.config/environment.d: dotconfig/environment.d

    # Reverse Recursive Lookup
    ~/.editorconfig: .editorconfig

- create:
    - ~/Projects

- shell:
    - [
        git submodule update --init --recursive --progress,
        Installing submodules,
      ]

    - [
        command -v starship || curl -fsSL https://starship.rs/install.sh | sh -s -- -y -f,
        Installing Starship,
      ]
    - [command -v mise || curl https://mise.run | sh, Installing mise]
    -
      command: 'mise doctor || true'
      description: Validating mise setup
      if: 'command -v mise'
    -
      command: 'command -v mise && mise install || true'
      description: Installing pinned mise tools
      if: 'command -v mise'

    -
      command: systemctl --user daemon-reload && systemctl --user enable --now ssh-agent
      description: Enabling ssh-agent systemd service
      if: '[ -d /run/systemd/system ] && [ -x "$(command -v systemctl)" ]'

    - [
        '[ -L ~/.ssh/config ] && rm ~/.ssh/config; mkdir -p ~/.ssh && touch ~/.ssh/config && grep -q "Include $(pwd)/ssh/config" ~/.ssh/config || echo "Include $(pwd)/ssh/config" >> ~/.ssh/config',
        Configuring SSH (Include),
      ]

    # Tmux plugin manager (TPM) and plugins
    -
      command: '[ -d ~/.tmux/plugins/tpm ] || git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'
      description: Installing tmux plugin manager (TPM)
      if: 'command -v tmux'

    -
      command: '[ -x ~/.tmux/plugins/tpm/scripts/install_plugins.sh ] && ~/.tmux/plugins/tpm/scripts/install_plugins.sh || true'
      description: Installing tmux plugins
      if: 'command -v tmux'
