# Alias

# Brew
alias ibrew='arch -x86_64 /usr/local/bin/brew'
alias mbrew='arch -arm64e /opt/homebrew/bin/brew'
ARCH=$(uname -m)
OS=$(uname -s)

if [[ "$OS" == "Darwin" && "$ARCH" == "arm64" ]]; then
  alias brew='mbrew'
fi

# Refreshments
alias reload="exec zsh && echo 'ZSH config reloaded from ~/.zshrc'"
alias ez="vim ~/.config/zsh/.zshrc && reload"
alias ev="vim ~/.config/vim/vimrc"
alias ea="vim ~/.config/zsh/.aliases && reload"
alias ef="vim ~/.config/zsh/functions/global && reload"
alias ep="vim ~/.config/zsh/.zprofile && reload"
alias eg="vim ~/.config/git/config && reload"

# Helpers
copyuuid() {
  local u
  u="$(uuidgen | tr -d '\n')" || return 1
  if command -v pbcopy >/dev/null 2>&1; then
    printf "%s" "$u" | pbcopy && pbpaste
  elif command -v wl-copy >/dev/null 2>&1; then
    printf "%s" "$u" | wl-copy && printf "%s\n" "$u"
  elif command -v xclip >/dev/null 2>&1; then
    printf "%s" "$u" | xclip -selection clipboard && printf "%s\n" "$u"
  else
    printf "%s\n" "$u"
  fi
}
alias toupper="tr '[:lower:]' '[:upper:]'"
alias tolower="tr '[:upper:]' '[:lower:]'"
alias isodate='date "+%Y-%m-%dT%H:%M:%S"'
alias onedrive='rclone --vfs-cache-mode full mount --daemon onedrive: ~/OneDrive'

# apps
alias python="python3"
alias pari="/usr/bin/gp"
alias bootwin="~/Desktop/reboot-windows.sh"
alias zsync="source ${ZDOTDIR:-$HOME}/.antidote/antidote.zsh && antidote load ${ZDOTDIR:-$HOME}/.zsh_plugins.txt"

# Smart SSH: Bootstraps dotfiles on new VPS
ssh() {
  # Only try to bootstrap if no flags are passed and only one argument (host)
  if [[ "$#" -eq 1 && "$1" != -* ]]; then
    local host="$1"
    # Try to check if dotfiles directory exists on the remote
    if ! command ssh -q -o ConnectTimeout=5 "$host" "[ -d ~/dotfiles ]" 2>/dev/null; then
      echo "ðŸš€ Fresh VPS detected! Bootstrapping dotfiles..."
      # Stream the bootstrap script to the remote and execute with bash
      command ssh -t "$host" "curl -fsSL https://raw.githubusercontent.com/p3dr4m/dotfiles/main/bin/bootstrap -o /tmp/bootstrap_dotfiles.sh && bash /tmp/bootstrap_dotfiles.sh && rm /tmp/bootstrap_dotfiles.sh"
    fi
  fi
  # Perform normal ssh login
  command ssh "$@"
}
